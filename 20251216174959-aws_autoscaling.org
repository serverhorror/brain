:PROPERTIES:
:ID:       6cd80bfb-e3da-4499-9e41-43d6bc4d0b05
:END:
#+title: AWS Autoscaling
#+filetags: :aws:kb:


- [[https://docs.aws.amazon.com/autoscaling/ec2/userguide/tutorial-ec2-auto-scaling-load-balancer.html][Tutorial: Set up a scaled and load-balanced application]]

* Creating an environment manually

1. SecurityGroup [SG] =alb-sg=

   - allow =tcp/80= from =0.0.0.0/0=
   - allow =tcp/443= from =0.0.0.0/0=

2. SecurityGroup =alb-2-app-sg=

   - allow =tcp/80= from self
   - allow =tcp/443= from self

3. TargetGroup [TG]
4. LoadBalancer [LB] (pointing to TargetGroup)
5. LaunchTemplate [LT]
6. Autoscalinggroup [Asg]

   - Add to sg =alb-2-app-sg=
   - register ASG with TG
   - use *Default* version from [LT]

* Using a custom image

1. create separate instance
2. connect via SSH
3. install the =nginx= web server
4. in EC2 create image
5. modify [LT] to use new image
6. start instance refresh

* Add a database

1. SG `app-2-db`
2. create instance
3. copy connection information around

   - follow
     :ref:`kb.architecture.aws-autoscaling.using-a-custom-image`
     to recreate image and renew instances


